!function(){"use strict";angular.module("ngCropper",["ng"]).directive("ngCropper",function(){return{restrict:"A",scope:{options:"=ngOptions"},link:function(e,t,n){var r=!1;e.$on(n.ngShow,function(){r||(r=!0,t.cropper(e.options||{}))}),e.$on(n.ngHide,function(){r&&(r=!1,t.cropper("destroy"))})}}}).service("Cropper",["$q",function(e){function t(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.style.display="none",document.body.appendChild(t),t}function n(e){e.parentElement.removeChild(e)}this.encode=function(t){var n=e.defer(),r=new FileReader;return r.onload=function(){n.resolve(r.result)},r.readAsDataURL(t),n.promise},this.decode=function(e){for(var t=e.split(";")[0],n=t.split(":")[1],r=atob(e.split(",")[1]),i=new Uint8Array(r.length),o=0;o<r.length;o++)i[o]=r.charCodeAt(o);return new Blob([i],{type:n})},this.crop=function(r,i){var o=e.defer(),a=this.decode;return this.encode(r).then(function(e){var c=t(i),d=c.getContext("2d"),h=new Image;h.src=e,d.drawImage(h,i.x,i.y,i.width,i.height,0,0,i.width,i.height);var s=c.toDataURL(r.type),u=a(s);o.resolve(u),n(c)}),o.promise},this.scale=function(r,i){var o=e.defer(),a=this.decode;return this.encode(r).then(function(e){var c=new Image;c.src=e;var d,h,s,u=c.height,p=c.width;angular.isNumber(i)&&(d=i,h=u*d,s=p*d),angular.isObject(i)&&(d=p/u,h=i.height,s=i.width,h&&!s?s=h*d:s&&!h&&(h=s/d));var g=t(i),l=g.getContext("2d");g.height=h,g.width=s,l.drawImage(c,0,0,p,u,0,0,s,h);var f=g.toDataURL(r.type),v=a(f);o.resolve(v),n(g)}),o.promise}}])}();
