!function(){"use strict";angular.module("ngCropper",["ng"]).directive("ngCropper",["$q",function(e){function t(t,o){t=t||{};var i=e.defer(),a=[n(t)];return t.maximize&&a.push(r(t,o)),e.all(a).then(function(e){var t=e[e.length-1];i.resolve(t)}),i.promise}function n(t){var n=e.defer();return n.resolve(t),n.promise}function r(t,n){var r=e.defer();return o(n).then(function(e){t.data=e,r.resolve(t)}),r.promise}function o(t){var n=e.defer(),r=new Image;return r.onload=function(){n.resolve({width:r.width,height:r.height})},r.src=t.src,n.promise}return{restrict:"A",scope:{options:"=ngOptions"},link:function(e,n,r){var o=!1;e.$on(r.ngShow,function(){o||(o=!0,t(e.options,n[0]).then(function(e){n.cropper(e)}))}),e.$on(r.ngHide,function(){o&&(o=!1,n.cropper("destroy"))}),e.$watch("options.disabled",function(e){o&&(console.log("disable:",e),e&&n.cropper("disable"),e||n.cropper("enable"))})}}}]).service("Cropper",["$q",function(e){function t(t){var n=e.defer(),r=new Image;return r.onload=function(e){n.resolve(e.target)},r.src=t,n.promise}function n(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.style.display="none",document.body.appendChild(t),t}function r(e){e.parentElement.removeChild(e)}this.encode=function(t){var n=e.defer(),r=new FileReader;return r.onload=function(e){n.resolve(e.target.result)},r.readAsDataURL(t),n.promise},this.decode=function(e){for(var t=e.split(";")[0],n=t.split(":")[1],r=atob(e.split(",")[1]),o=new Uint8Array(r.length),i=0;i<r.length;i++)o[i]=r.charCodeAt(i);return new Blob([o],{type:n})},this.crop=function(o,i){var a=e.defer(),c=this.decode;return this.encode(o).then(t).then(function(e){var t=n(i),s=t.getContext("2d");s.drawImage(e,i.x,i.y,i.width,i.height,0,0,i.width,i.height);var d=t.toDataURL(o.type),h=c(d);a.resolve(h),r(t)}),a.promise},this.scale=function(o,i){var a=e.defer(),c=this.decode;return this.encode(o).then(t).then(function(e){var t,s,d,h=e.height,u=e.width;angular.isNumber(i)&&(t=i,s=h*t,d=u*t),angular.isObject(i)&&(t=u/h,s=i.height,d=i.width,s&&!d?d=s*t:d&&!s&&(s=d/t));var l=n(i),p=l.getContext("2d");l.height=s,l.width=d,p.drawImage(e,0,0,u,h,0,0,d,s);var f=l.toDataURL(o.type),g=c(f);a.resolve(g),r(l)}),a.promise}}])}();
