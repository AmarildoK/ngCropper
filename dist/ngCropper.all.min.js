!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){"use strict";var e=t(window),i=t(document),h=window.location,a=!0,r=!1,s=null,n=0/0,o=1/0,d="undefined",g="directive",l=".cropper",c=/^(e|n|w|s|ne|nw|sw|se|all|crop|move|zoom)$/,p=/^(x|y|width|height)$/,u=/^(naturalWidth|naturalHeight|width|height|aspectRatio|ratio|rotate)$/,f="cropper-modal",m="cropper-hidden",w="cropper-invisible",v="cropper-move",x="cropper-crop",b="cropper-disabled",y="mousedown touchstart",$="mousemove touchmove",D="mouseup mouseleave touchend touchleave touchcancel",C="wheel mousewheel DOMMouseScroll",W="resize"+l,H="dblclick",k="build"+l,R="built"+l,L="dragstart"+l,z="dragmove"+l,Y="dragend"+l,I=function(t){return"number"==typeof t},X=function(t,e){var i=[];return I(e)&&i.push(e),i.slice.apply(t,i)},T=function(t,e){var i=X(arguments,2);return function(){return t.apply(e,i.concat(X(arguments)))}},E=function(t){var e="timestamp="+(new Date).getTime();return t+(-1===t.indexOf("?")?"?":"&")+e},M=function(e,i){this.element=e,this.$element=t(e),this.defaults=t.extend({},M.DEFAULTS,t.isPlainObject(i)?i:{}),this.$original=s,this.ready=r,this.built=r,this.cropped=r,this.rotated=r,this.disabled=r,this.replaced=r,this.init()},U=Math.sqrt,_=Math.min,A=Math.max,O=Math.abs,P=Math.sin,j=Math.cos,F=parseFloat;M.prototype={constructor:M,support:{canvas:t.isFunction(t("<canvas>")[0].getContext)},init:function(){var e=this.defaults;t.each(e,function(t,i){switch(t){case"aspectRatio":e[t]=O(F(i))||n;break;case"autoCropArea":e[t]=O(F(i))||.8;break;case"minWidth":case"minHeight":e[t]=O(F(i))||0;break;case"maxWidth":case"maxHeight":e[t]=O(F(i))||o}}),this.image={rotate:0},this.load()},load:function(){var e,i,h=this,r=this.$element,s=this.element,n=this.image,o="";r.is("img")?i=r.prop("src"):r.is("canvas")&&this.support.canvas&&(i=s.toDataURL()),i&&(this.replaced&&(n.rotate=0),this.defaults.checkImageOrigin&&this.isCrossOriginURL(i)&&(o=" crossOrigin",i=E(i)),this.$clone=e=t("<img"+o+' src="'+i+'">'),e.one("load",function(){n.naturalWidth=this.naturalWidth||e.width(),n.naturalHeight=this.naturalHeight||e.height(),n.aspectRatio=n.naturalWidth/n.naturalHeight,h.url=i,h.ready=a,h.build()}),e.addClass(w).prependTo("body"))},isCrossOriginURL:function(t){var e=t.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return!e||e[1]===h.protocol&&e[2]===h.hostname&&e[3]===h.port?r:a},build:function(){var e,i,h=this.$element,s=this.defaults;this.ready&&(this.built&&this.unbuild(),h.one(k,s.build),e=t.Event(k),h.trigger(e),e.isDefaultPrevented()||(this.$cropper=i=t(M.TEMPLATE),h.addClass(m),this.$clone.removeClass(w).prependTo(i),this.rotated||(this.$original=this.$clone.clone(),this.$original.addClass(m).prependTo(this.$cropper),this.originalImage=t.extend({},this.image)),this.$container=h.parent(),this.$container.append(i),this.$canvas=i.find(".cropper-canvas"),this.$dragger=i.find(".cropper-dragger"),this.$viewer=i.find(".cropper-viewer"),s.autoCrop?this.cropped=a:this.$dragger.addClass(m),s.modal&&this.$canvas.addClass(f),!s.dashed&&this.$dragger.find(".cropper-dashed").addClass(m),!s.movable&&this.$dragger.find(".cropper-face").data(g,"move"),!s.resizable&&this.$dragger.find(".cropper-line, .cropper-point").addClass(m),this.addListeners(),this.initPreview(),this.built=a,s.dragCrop&&this.setDragMode("crop"),this.update(),this.replaced=r,h.one(R,s.built),h.trigger(R)))},unbuild:function(){this.built&&(this.built=r,this.removeListeners(),this.$preview.empty(),this.$preview=s,this.$dragger=s,this.$canvas=s,this.$container=s,this.$cropper.remove(),this.$cropper=s)},update:function(t){this.initContainer(),this.initCropper(),this.initImage(),this.initDragger(),t?(this.setData(t,a),this.setDragMode("crop")):this.setData(this.defaults.data)},resize:function(){clearTimeout(this.resizing),this.resizing=setTimeout(t.proxy(this.update,this,this.getData()),200)},preview:function(){var e=this.image,i=this.dragger,h=e.width,a=e.height,r=i.left-e.left,s=i.top-e.top;this.$viewer.find("img").css({width:h,height:a,marginLeft:-r,marginTop:-s}),this.$preview.each(function(){var e=t(this),n=e.data(),o=n.width/i.width,d=n.width,g=i.height*o;g>n.height&&(o=n.height/i.height,d=i.width*o,g=n.height),e.width(d).height(g).find("img").css({width:h*o,height:a*o,marginLeft:-r*o,marginTop:-s*o})})},addListeners:function(){var h=this.defaults;this.$element.on(L,h.dragstart).on(z,h.dragmove).on(Y,h.dragend),this.$cropper.on(y,t.proxy(this.dragstart,this)).on(H,t.proxy(this.dblclick,this)),h.zoomable&&this.$cropper.on(C,t.proxy(this.wheel,this)),h.multiple?this.$cropper.on($,t.proxy(this.dragmove,this)).on(D,t.proxy(this.dragend,this)):i.on($,this._dragmove=T(this.dragmove,this)).on(D,this._dragend=T(this.dragend,this)),e.on(W,this._resize=T(this.resize,this))},removeListeners:function(){var t=this.defaults;this.$element.off(L,t.dragstart).off(z,t.dragmove).off(Y,t.dragend),this.$cropper.off(y,this.dragstart).off(H,this.dblclick),t.zoomable&&this.$cropper.off(C,this.wheel),t.multiple?this.$cropper.off($,this.dragmove).off(D,this.dragend):i.off($,this._dragmove).off(D,this._dragend),e.off(W,this._resize)},initPreview:function(){var e=this.url;this.$preview=t(this.defaults.preview),this.$viewer.html('<img src="'+e+'">'),this.$preview.each(function(){var i=t(this);i.data({width:i.width(),height:i.height()}).html('<img src="'+e+'" style="display:block;width:100%;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;">')})},initContainer:function(){var t=this.$element,e=this.$container,i=this.$cropper,h=this.defaults;i.addClass(m),t.removeClass(m),this.container={width:A(e.width(),h.minContainerWidth),height:A(e.height(),h.minContainerHeight)},t.addClass(m),i.removeClass(m)},initCropper:function(){var t,e=this.container,i=this.image;i.naturalWidth*e.height/i.naturalHeight-e.width>=0?(t={width:e.width,height:e.width/i.aspectRatio,left:0},t.top=(e.height-t.height)/2):(t={width:e.height*i.aspectRatio,height:e.height,top:0},t.left=(e.width-t.width)/2),this.$cropper.css({width:t.width,height:t.height,left:t.left,top:t.top}),this.cropper=t},initImage:function(){var e=this.image,i=this.cropper,h={_width:i.width,_height:i.height,width:i.width,height:i.height,left:0,top:0,ratio:i.width/e.naturalWidth};this.defaultImage=t.extend({},e,h),e._width!==i.width||e._height!==i.height?t.extend(e,h):(e=t.extend({},h,e),this.replaced&&(e.ratio=h.ratio)),this.image=e,this.renderImage()},renderImage:function(t){var e=this.image;"zoom"===t&&(e.left-=(e.width-e.oldWidth)/2,e.top-=(e.height-e.oldHeight)/2),e.left=_(A(e.left,e._width-e.width),0),e.top=_(A(e.top,e._height-e.height),0),this.$clone.css({width:e.width,height:e.height,marginLeft:e.left,marginTop:e.top}),t&&(this.defaults.done(this.getData()),this.preview())},initDragger:function(){var e,i,h=this.defaults,a=this.cropper,r=h.aspectRatio||this.image.aspectRatio,s=this.image.ratio;i=a.height*r-a.width>=0?{height:a.width/r,width:a.width,left:0,top:(a.height-a.width/r)/2,maxWidth:a.width,maxHeight:a.width/r}:{height:a.height,width:a.height*r,left:(a.width-a.height*r)/2,top:0,maxWidth:a.height*r,maxHeight:a.height},i.minWidth=0,i.minHeight=0,h.aspectRatio?(isFinite(h.maxWidth)?(i.maxWidth=_(i.maxWidth,h.maxWidth*s),i.maxHeight=i.maxWidth/r):isFinite(h.maxHeight)&&(i.maxHeight=_(i.maxHeight,h.maxHeight*s),i.maxWidth=i.maxHeight*r),h.minWidth>0?(i.minWidth=A(0,h.minWidth*s),i.minHeight=i.minWidth/r):h.minHeight>0&&(i.minHeight=A(0,h.minHeight*s),i.minWidth=i.minHeight*r)):(i.maxWidth=_(i.maxWidth,h.maxWidth*s),i.maxHeight=_(i.maxHeight,h.maxHeight*s),i.minWidth=A(0,h.minWidth*s),i.minHeight=A(0,h.minHeight*s)),i.minWidth=_(i.maxWidth,i.minWidth),i.minHeight=_(i.maxHeight,i.minHeight),e=t.extend({},i),e.width=A(i.minWidth,i.width*h.autoCropArea),e.height=A(i.minHeight,i.height*h.autoCropArea),e.left=(a.width-e.width)/2,e.top=(a.height-e.height)/2,e.oldLeft=i.oldLeft=i.left,e.oldTop=i.oldTop=i.top,this.autoCropDragger=e,this.defaultDragger=t.extend({},i),this.dragger=i},renderDragger:function(){var t=this.dragger,e=this.cropper;t.width>t.maxWidth?(t.width=t.maxWidth,t.left=t.oldLeft):t.width<t.minWidth&&(t.width=t.minWidth,t.left=t.oldLeft),t.height>t.maxHeight?(t.height=t.maxHeight,t.top=t.oldTop):t.height<t.minHeight&&(t.height=t.minHeight,t.top=t.oldTop),t.left=_(A(t.left,0),e.width-t.width),t.top=_(A(t.top,0),e.height-t.height),t.oldLeft=t.left,t.oldTop=t.top,this.dragger=t,this.defaults.movable&&this.$dragger.find(".cropper-face").data(g,t.width===e.width&&t.height===e.height?"move":"all"),this.disabled||this.defaults.done(this.getData()),this.$dragger.css({width:t.width,height:t.height,left:t.left,top:t.top}),this.preview()},reset:function(e){this.cropped&&!this.disabled&&(e&&(this.defaults.data={}),this.image=t.extend({},this.defaultImage),this.renderImage(),this.dragger=t.extend({},this.defaultDragger),this.setData(this.defaults.data))},clear:function(){this.cropped&&!this.disabled&&(this.cropped=r,this.setData({x:0,y:0,width:0,height:0}),this.$canvas.removeClass(f),this.$dragger.addClass(m))},destroy:function(){var t=this.$element;this.ready||this.$clone.off("load").remove(),this.unbuild(),t.removeClass(m).removeData("cropper"),this.rotated&&t.attr("src",this.$original.attr("src"))},replace:function(e,i){var h,s=this,n=this.$element,o=this.element;!this.disabled&&e&&e!==this.url&&e!==n.attr("src")&&(i||(this.rotated=r,this.replaced=a),n.is("img")?(n.attr("src",e),this.load()):n.is("canvas")&&this.support.canvas&&(h=o.getContext("2d"),t('<img src="'+e+'">').one("load",function(){o.width=this.width,o.height=this.height,h.clearRect(0,0,o.width,o.height),h.drawImage(this,0,0),s.load()})))},setData:function(e,i){var h=this.cropper,a=this.dragger,r=this.image,n=this.defaults.aspectRatio;this.built&&!this.disabled&&typeof e!==d&&((e===s||t.isEmptyObject(e))&&(a=t.extend({},this.autoCropDragger)),t.isPlainObject(e)&&!t.isEmptyObject(e)&&(i||(this.defaults.data=e),e=this.transformData(e),I(e.x)&&e.x<=h.width-r.left&&(a.left=e.x+r.left),I(e.y)&&e.y<=h.height-r.top&&(a.top=e.y+r.top),n?I(e.width)&&e.width<=a.maxWidth&&e.width>=a.minWidth?(a.width=e.width,a.height=a.width/n):I(e.height)&&e.height<=a.maxHeight&&e.height>=a.minHeight&&(a.height=e.height,a.width=a.height*n):(I(e.width)&&e.width<=a.maxWidth&&e.width>=a.minWidth&&(a.width=e.width),I(e.height)&&e.height<=a.maxHeight&&e.height>=a.minHeight&&(a.height=e.height))),this.dragger=a,this.renderDragger())},getData:function(t){var e=this.dragger,i=this.image,h={};return this.built&&(h={x:e.left-i.left,y:e.top-i.top,width:e.width,height:e.height},h=this.transformData(h,a,t)),h},transformData:function(e,i,h){var a=this.image.ratio,r={};return t.each(e,function(t,e){e=F(e),p.test(t)&&!isNaN(e)&&(r[t]=i?h?Math.round(e/a):e/a:e*a)}),r},setAspectRatio:function(t){var e="auto"===t;this.disabled||(t=F(t),(e||!isNaN(t)&&t>0)&&(this.defaults.aspectRatio=e?n:t,this.built&&(this.initDragger(),this.renderDragger(),this.setData(this.defaults.data))))},getImageData:function(){var e={};return this.ready&&t.each(this.image,function(t,i){u.test(t)&&(e[t]=i)}),e},getDataURL:function(e,i,h){var a,r=t("<canvas>")[0],s=this.getData(),n="";return t.isPlainObject(e)||(h=i,i=e,e={}),e=t.extend({width:s.width,height:s.height},e),this.cropped&&this.support.canvas&&(r.width=e.width,r.height=e.height,a=r.getContext("2d"),"image/jpeg"===i&&(a.fillStyle="#fff",a.fillRect(0,0,e.width,e.height)),a.drawImage(this.$clone[0],s.x,s.y,s.width,s.height,0,0,e.width,e.height),n=r.toDataURL(i,h)),n},setDragMode:function(t){var e=this.$canvas,i=this.defaults,h=r,s=r;if(this.built&&!this.disabled){switch(t){case"crop":i.dragCrop&&(h=a,e.data(g,t));break;case"move":s=a,e.data(g,t);break;default:e.removeData(g)}e.toggleClass(x,h).toggleClass(v,s)}},enable:function(){this.built&&(this.disabled=r,this.$cropper.removeClass(b))},disable:function(){this.built&&(this.disabled=a,this.$cropper.addClass(b))},rotate:function(t){var e=this.image;t=F(t)||0,this.built&&0!==t&&!this.disabled&&this.defaults.rotatable&&this.support.canvas&&(this.rotated=a,t=e.rotate=(e.rotate+t)%360,this.replace(this.getRotatedDataURL(t),!0))},getRotatedDataURL:function(e){var i=t("<canvas>")[0],h=i.getContext("2d"),a=this.originalImage,r=a.naturalWidth,s=a.naturalHeight,n=O(e)%180,o=(n>90?180-n:n)*Math.PI/180,d=r*j(o)+s*P(o),g=r*P(o)+s*j(o);return i.width=d,i.height=g,h.save(),h.translate(d/2,g/2),h.rotate(e*Math.PI/180),h.drawImage(this.$original[0],-r/2,-s/2,r,s),h.restore(),i.toDataURL()},zoom:function(t){var e,i,h,a=this.image;t=F(t),this.built&&t&&!this.disabled&&this.defaults.zoomable&&(e=a.width*(1+t),i=a.height*(1+t),h=e/a._width,h>10||(1>h&&(e=a._width,i=a._height),this.setDragMode(1>=h?"crop":"move"),a.oldWidth=a.width,a.oldHeight=a.height,a.width=e,a.height=i,a.ratio=a.width/a.naturalWidth,this.renderImage("zoom")))},dblclick:function(){this.disabled||this.setDragMode(this.$canvas.hasClass(x)?"move":"crop")},wheel:function(t){var e=t.originalEvent,i=1;this.disabled||(t.preventDefault(),e.deltaY?i=e.deltaY>0?1:-1:e.wheelDelta?i=-e.wheelDelta/120:e.detail&&(i=e.detail>0?1:-1),this.zoom(.1*i))},dragstart:function(e){var i,h,s,n=e.originalEvent.touches,o=e;if(!this.disabled){if(n){if(s=n.length,s>1){if(!this.defaults.zoomable||2!==s)return;o=n[1],this.startX2=o.pageX,this.startY2=o.pageY,i="zoom"}o=n[0]}if(i=i||t(o.target).data(g),c.test(i)){if(e.preventDefault(),h=t.Event(L),this.$element.trigger(h),h.isDefaultPrevented())return;this.directive=i,this.cropping=r,this.startX=o.pageX,this.startY=o.pageY,"crop"===i&&(this.cropping=a,this.$canvas.addClass(f))}}},dragmove:function(e){var i,h,a=e.originalEvent.touches,r=e;if(!this.disabled){if(a){if(h=a.length,h>1){if(!this.defaults.zoomable||2!==h)return;r=a[1],this.endX2=r.pageX,this.endY2=r.pageY}r=a[0]}if(this.directive){if(e.preventDefault(),i=t.Event(z),this.$element.trigger(i),i.isDefaultPrevented())return;this.endX=r.pageX,this.endY=r.pageY,this.dragging()}}},dragend:function(e){var i;if(!this.disabled&&this.directive){if(e.preventDefault(),i=t.Event(Y),this.$element.trigger(i),i.isDefaultPrevented())return;this.cropping&&(this.cropping=r,this.$canvas.toggleClass(f,this.cropped&&this.defaults.modal)),this.directive=""}},dragging:function(){var t,e=this.directive,i=this.image,h=this.cropper,s=h.width,n=h.height,o=this.dragger,d=o.width,g=o.height,l=o.left,c=o.top,p=l+d,u=c+g,f=a,w=this.defaults.aspectRatio,v={x:this.endX-this.startX,y:this.endY-this.startY};switch(w&&(v.X=v.y*w,v.Y=v.x/w),e){case"all":l+=v.x,c+=v.y;break;case"e":if(v.x>=0&&(p>=s||w&&(0>=c||u>=n))){f=r;break}d+=v.x,w&&(g=d/w,c-=v.Y/2),0>d&&(e="w",d=0);break;case"n":if(v.y<=0&&(0>=c||w&&(0>=l||p>=s))){f=r;break}g-=v.y,c+=v.y,w&&(d=g*w,l+=v.X/2),0>g&&(e="s",g=0);break;case"w":if(v.x<=0&&(0>=l||w&&(0>=c||u>=n))){f=r;break}d-=v.x,l+=v.x,w&&(g=d/w,c+=v.Y/2),0>d&&(e="e",d=0);break;case"s":if(v.y>=0&&(u>=n||w&&(0>=l||p>=s))){f=r;break}g+=v.y,w&&(d=g*w,l-=v.X/2),0>g&&(e="n",g=0);break;case"ne":if(w){if(v.y<=0&&(0>=c||p>=s)){f=r;break}g-=v.y,c+=v.y,d=g*w}else v.x>=0?s>p?d+=v.x:v.y<=0&&0>=c&&(f=r):d+=v.x,v.y<=0?c>0&&(g-=v.y,c+=v.y):(g-=v.y,c+=v.y);0>d&&0>g?(e="sw",g=0,d=0):0>d?(e="nw",d=0):0>g&&(e="se",g=0);break;case"nw":if(w){if(v.y<=0&&(0>=c||0>=l)){f=r;break}g-=v.y,c+=v.y,d=g*w,l+=v.X}else v.x<=0?l>0?(d-=v.x,l+=v.x):v.y<=0&&0>=c&&(f=r):(d-=v.x,l+=v.x),v.y<=0?c>0&&(g-=v.y,c+=v.y):(g-=v.y,c+=v.y);0>d&&0>g?(e="se",g=0,d=0):0>d?(e="ne",d=0):0>g&&(e="sw",g=0);break;case"sw":if(w){if(v.x<=0&&(0>=l||u>=n)){f=r;break}d-=v.x,l+=v.x,g=d/w}else v.x<=0?l>0?(d-=v.x,l+=v.x):v.y>=0&&u>=n&&(f=r):(d-=v.x,l+=v.x),v.y>=0?n>u&&(g+=v.y):g+=v.y;0>d&&0>g?(e="ne",g=0,d=0):0>d?(e="se",d=0):0>g&&(e="nw",g=0);break;case"se":if(w){if(v.x>=0&&(p>=s||u>=n)){f=r;break}d+=v.x,g=d/w}else v.x>=0?s>p?d+=v.x:v.y>=0&&u>=n&&(f=r):d+=v.x,v.y>=0?n>u&&(g+=v.y):g+=v.y;0>d&&0>g?(e="nw",g=0,d=0):0>d?(e="sw",d=0):0>g&&(e="ne",g=0);break;case"move":i.left+=v.x,i.top+=v.y,this.renderImage("move"),f=r;break;case"zoom":this.zoom(function(t,e,i,h,a,r){return(U(a*a+r*r)-U(i*i+h*h))/U(t*t+e*e)}(i.width,i.height,O(this.startX-this.startX2),O(this.startY-this.startY2),O(this.endX-this.endX2),O(this.endY-this.endY2))),this.endX2=this.startX2,this.endY2=this.startY2,f=r;break;case"crop":v.x&&v.y&&(t=this.$cropper.offset(),l=this.startX-t.left,c=this.startY-t.top,d=o.minWidth,g=o.minHeight,v.x>0?v.y>0?e="se":(e="ne",c-=g):v.y>0?(e="sw",l-=d):(e="nw",l-=d,c-=g),this.cropped||(this.cropped=a,this.$dragger.removeClass(m)))}f&&(o.width=d,o.height=g,o.left=l,o.top=c,this.directive=e,this.renderDragger()),this.startX=this.endX,this.startY=this.endY}},M.TEMPLATE=function(t,e){return e=e.split(","),t.replace(/\d+/g,function(t){return e[t]})}('<0 6="5-container"><0 6="5-canvas"></0><0 6="5-dragger"><1 6="5-viewer"></1><1 6="5-8 8-h"></1><1 6="5-8 8-v"></1><1 6="5-face" 3-2="all"></1><1 6="5-7 7-e" 3-2="e"></1><1 6="5-7 7-n" 3-2="n"></1><1 6="5-7 7-w" 3-2="w"></1><1 6="5-7 7-s" 3-2="s"></1><1 6="5-4 4-e" 3-2="e"></1><1 6="5-4 4-n" 3-2="n"></1><1 6="5-4 4-w" 3-2="w"></1><1 6="5-4 4-s" 3-2="s"></1><1 6="5-4 4-ne" 3-2="ne"></1><1 6="5-4 4-nw" 3-2="nw"></1><1 6="5-4 4-sw" 3-2="sw"></1><1 6="5-4 4-se" 3-2="se"></1></0></0>',"div,span,directive,data,point,cropper,class,line,dashed"),M.DEFAULTS={aspectRatio:"auto",autoCropArea:.8,data:{},done:t.noop,preview:"",multiple:r,autoCrop:a,dragCrop:a,dashed:a,modal:a,movable:a,resizable:a,zoomable:a,rotatable:a,checkImageOrigin:a,minWidth:0,minHeight:0,maxWidth:o,maxHeight:o,minContainerWidth:300,minContainerHeight:150,build:s,built:s,dragstart:s,dragmove:s,dragend:s},M.setDefaults=function(e){t.extend(M.DEFAULTS,e)},M.other=t.fn.cropper,t.fn.cropper=function(e){var i,h=X(arguments,1);return this.each(function(){var a,r=t(this),s=r.data("cropper");s||r.data("cropper",s=new M(this,e)),"string"==typeof e&&t.isFunction(a=s[e])&&(i=a.apply(s,h))}),typeof i!==d?i:this},t.fn.cropper.Constructor=M,t.fn.cropper.setDefaults=M.setDefaults,t.fn.cropper.noConflict=function(){return t.fn.cropper=M.other,this}}),function(){"use strict";angular.module("ngCropper",["ng"]).directive("ngCropper",["$q",function(t){function e(e,a){e=e||{};var r=t.defer(),s=[i(e)];return e.maximize&&s.push(h(e,a)),t.all(s).then(function(t){var e=t[t.length-1];r.resolve(e)}),r.promise}function i(e){var i=t.defer();return i.resolve(e),i.promise}function h(e,i){var h=t.defer();return a(i).then(function(t){e.data=t,h.resolve(e)}),h.promise}function a(e){var i=t.defer(),h=new Image;return h.onload=function(){i.resolve({width:h.width,height:h.height})},h.src=e.src,i.promise}return{restrict:"A",scope:{options:"=ngOptions"},link:function(t,i,h){var a=!1;t.$on(h.ngShow,function(){a||(a=!0,e(t.options,i[0]).then(function(t){i.cropper(t)}))}),t.$on(h.ngHide,function(){a&&(a=!1,i.cropper("destroy"))}),t.$watch("options.disabled",function(t){a&&(t&&i.cropper("disable"),t||i.cropper("enable"))})}}}]).service("Cropper",["$q",function(t){function e(e){var i=t.defer(),h=new Image;return h.onload=function(t){i.resolve(t.target)},h.src=e,i.promise}function i(t){var e=document.createElement("canvas");return e.width=t.width,e.height=t.height,e.style.display="none",document.body.appendChild(e),e}function h(t){t.parentElement.removeChild(t)}this.encode=function(e){var i=t.defer(),h=new FileReader;return h.onload=function(t){i.resolve(t.target.result)},h.readAsDataURL(e),i.promise},this.decode=function(t){for(var e=t.split(";")[0],i=e.split(":")[1],h=atob(t.split(",")[1]),a=new Uint8Array(h.length),r=0;r<h.length;r++)a[r]=h.charCodeAt(r);return new Blob([a],{type:i})},this.crop=function(a,r){var s=t.defer(),n=this.decode;return this.encode(a).then(e).then(function(t){var e=i(r),o=e.getContext("2d");o.drawImage(t,r.x,r.y,r.width,r.height,0,0,r.width,r.height);var d=e.toDataURL(a.type),g=n(d);s.resolve(g),h(e)}),s.promise},this.scale=function(a,r){var s=t.defer(),n=this.decode;return this.encode(a).then(e).then(function(t){var e,o,d,g=t.height,l=t.width;angular.isNumber(r)&&(e=r,o=g*e,d=l*e),angular.isObject(r)&&(e=l/g,o=r.height,d=r.width,o&&!d?d=o*e:d&&!o&&(o=d/e));var c=i(r),p=c.getContext("2d");c.height=o,c.width=d,p.drawImage(t,0,0,l,g,0,0,d,o);var u=c.toDataURL(a.type),f=n(u);s.resolve(f),h(c)}),s.promise}}])}();
